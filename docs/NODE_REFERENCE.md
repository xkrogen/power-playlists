# Node Reference

This page provides a reference for all supported node types in `power-playlists`.

## `all_tracks`

A source node representing all liked/saved/heart-ed tracks, as well as all tracks saved in any of the current
user's playlists.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `include_dynamic` | boolean | optional | If true, include dynamic playlists generated by `power-playlists` when gathering the set of all playlists to consolidate. Default is false. Generally not recommended to set to true. |

## `combine_sort_dedup_output`

A meta-node combining the logic of `combiner`, `sort`, `dedup`,
and `output`. This is useful for the common case of gathering together a few inputs, removing
any duplicates, sorting it by some field, and saving it. Must supply either `input_uris` OR `input_nodes`.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `output_playlist_name` | string | required | The name of the output playlist. See `output`. |
| `sort_key` | string | required | See `sort`. |
| `input_nodes` | sequence of string | semi-optional | A sequence of node names to use as inputs. |
| `input_uris` | sequence of string | semi-optional | A sequence of playlist URIs that should be used as inputs. Each URI should be in the format `spotify:playlist:xxxxxx`. |
| `sort_desc` | boolean | optional | See `sort`. |

## `combiner`

An intermediate node which takes multiple inputs and combines them together. Currently only appending the inputs
one after another is supported. If three inputs A, B, and C are provided, the output will consist of all tracks of
A, followed by all tracks of B, followed by all tracks of C.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `inputs` | sequence of string | required | The names of the nodes to use as the inputs for this node. |
| `combine_type` | string | optional | Define how to combine the inputs. This can be `concat`, in which case the inputs are concatenated one after another, or `interleave`, in which songs are chosen "round-robin" style. For example if the inputs have songs `[1, 2, 3]`, `[4, 5]`, and `[6]`, `concat` would result in an output of `[1, 2, 3, 4, 5, 6]`, whereas interleave would result in `[1, 4, 6, 2, 5, 3]`. Defaults to `concat`. |

## `dedup`

An intermediate node which removes duplicate tracks from its input. Duplicates are detected based on the URI of
the song, so for example, a song with the same title may still appear twice in the output if it appeared on
two different albums.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `input` | string | required | The name of the node to use as the input for this node. Note than this can only have one input; if multiple nodes should be combined into a single playlist, use a `combiner`. |
| `use_uris` | boolean | optional | If true, use the full URI of the track to determine duplicates. Otherwise, the track name + album name + artist name(s) are used. If conflicts are detected, the first track encountered is kept and the rest are discarded. Defaults to false. (This mainly exists because it has been observed that sometimes a track may have multiple URIs, despite having the same title, artist, and album.) |

## `dynamic_template`

This is a meta-node which allows for defining a set of nodes which should be applied multiple times, for different
inputs. A template is provided, which is a dictionary of `node_id` to node definition, the same as a top-level
node definition. However, `{var_name}` can appear anywhere in the definition (including, and necessarily, in the
node ID). Multiple variables can be used, even in the same value. Then, a sequence of instances are provided,
each of which is a dictionary where each key is a variable name (such as `var_name` above) and the value is the
value to use for that variable. A copy of all of the nodes from the template will be instantiated for each
dictionary, and all variables will be substituted by their values.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `template` | dictionary | required | A dictionary defining a set of nodes to use as a template. |
| `instances` | sequence of dictionaries | required | A sequence of dictionaries defining the variables to use for instances of the template. One copy of the template nodes will be created for each instance dictionary. |

## `filter_eval`

An intermediate node which filters the tracks from its input based on some Python predicate. Only tracks for
which the predicate evaluates to true will be kept. This is an advanced/experimental feature.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `input` | string | required | The name of the node to use as the input for this node. Note than this can only have one input; if multiple nodes should be combined into a single playlist, use a `combiner`. |
| `predicate` | string | required | A Python 3 expression which should evaluate to true (to keep the track) or false (to drop the track). The `spotify_client.Track` object in question is made available as a variable named `t`. For example, you could write `t.popularity > 50` to only keep tracks with a popularity rating above 50. |

## `filter_release_date`

An intermediate node which filters the tracks from its input depending on the time they were release.
See the [Time Based Filtering Nodes](#time-based-filtering-nodes) section for more details.

## `filter_time_added`

An intermediate node which filters the tracks from its input depending on the time they were added (to saved
tracks or to their playlists). See the [Time Based Filtering Nodes](#time-based-filtering-nodes) section for more
details.

## `is_liked`

An intermediate node which filters tracks from its input to include only tracks which have been liked/saved.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `input` | string | required | The name of the node to use as the input for this node. Note than this can only have one input; if multiple nodes should be combined into a single playlist, use a `combiner`. |

## `liked_tracks`

A source node representing all liked/saved/heart-ed tracks.

## `limit`

An intermediate node which takes a single input and limits it to some maximum size.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `input` | string | required | The name of the node to use as the input for this node. Note than this can only have one input; if multiple nodes should be combined into a single playlist, use a `combiner`. |
| `max_size` | integer | required | The maximum number of tracks to include in the output of this node. |

## `output`

An output node which saves the tracks from its input to a playlist named `playlist_name`. If a playlist of this
name already exists, it will be overwritten.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `input` | string | required | The name of the node to use as the input for this node. Note than this can only have one input; if multiple nodes should be combined into a single playlist, use a `combiner`. |

## `playlist`

A source node representing all of the tracks from a given playlist.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `uri` | string | required | URI of the playlist, like `spotify:playlist:xxxxxxx` |

## `sort`

An intermediate node which sorts the tracks from its input.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `input` | string | required | The name of the node to use as the input for this node. Note than this can only have one input; if multiple nodes should be combined into a single playlist, use a `combiner`. |
| `sort_key` | string | required | Defines what to sort the tracks by. Allowed values are `time_added` (time at which track was saved or added to its playlist), `name` (name of track), `artist` (name of primary artist), `album` (name of album), and `release_date` (date track was released). |
| `sort_desc` | boolean | optional | If true, sort in descending order, like "z, y, x" or "3, 2, 1". Otherwise, sort in ascending order, like "a, b, c" or "1, 2, 3". Defaults to false. |

# Time Based Filtering Nodes

An intermediate node which filters the tracks from its input depending on some time field. This node cannot
be used directly; one of the subtypes must be used to select *which* time field to filter on (added time if
`filter_time_added` is used, or release date if `filter_release_date` is used).
Must supply either `days_ago` OR `cutoff_time`, but NOT both.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `input` | string | required | The name of the node to use as the input for this node. Note than this can only have one input; if multiple nodes should be combined into a single playlist, use a `combiner`. |
| `days_ago` | integer | semi-optional | Number of days prior to the current date to use as the cutoff time. This is a relative cutoff which will change depending on when it is run. |
| `cutoff_time` | date-time | semi-optional | An [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) date-time string to use as the cutoff time. This is an absolute cutoff not dependent on when it is run. Examples of ISO 8601 formats include `2020-01-01` (January 1, 2020) and `2020-01-01T14:30` (2:30PM on January 1, 2020). |
| `keep_before` | boolean | optional | If true, keep tracks *before* the cutoff specified by `days_ago` or `cutoff_time`. Otherwise, keep tracks *after* the cutoff. Defaults to false. |
